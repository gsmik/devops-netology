# Домашнее задание к занятию 5. «Elasticsearch»## Задача 1В этом задании вы потренируетесь в:- установке Elasticsearch,- первоначальном конфигурировании Elasticsearch,- запуске Elasticsearch в Docker.Используя Docker-образ [centos:7](https://hub.docker.com/_/centos) как базовый и [документацию по установке и запуску Elastcisearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/targz.html):- составьте Dockerfile-манифест для Elasticsearch,- соберите Docker-образ и сделайте `push` в ваш docker.io-репозиторий,- запустите контейнер из получившегося образа и выполните запрос пути `/` c хост-машины.Требования к `elasticsearch.yml`:- данные `path` должны сохраняться в `/var/lib`,- имя ноды должно быть `netology_test`.В ответе приведите:- текст Dockerfile-манифеста,- ссылку на образ в репозитории dockerhub,- ответ `Elasticsearch` на запрос пути `/` в json-виде.Подсказки:- возможно, вам понадобится установка пакета perl-Digest-SHA для корректной работы пакета shasum,- при сетевых проблемах внимательно изучите кластерные и сетевые настройки в elasticsearch.yml,- при некоторых проблемах вам поможет Docker-директива ulimit,- Elasticsearch в логах обычно описывает проблему и пути её решения.Далее мы будем работать с этим экземпляром Elasticsearch.*Ответ** текст Dockerfile-манифеста,    <details>    ```shell    FROM centos:7    EXPOSE 9200    ENV TZ=Europe/Moscow    MAINTAINER gsmik    RUN yum install java-11-openjdk-devel -y    RUN yum install wget -y    RUN yum install unzip -y    RUN wget https://artifacts.opensearch.org/releases/bundle/opensearch/2.6.0/opensearch-2.6.0-linux-x64.tar.gz    RUN tar -xzf opensearch-2.6.0-linux-x64.tar.gz    ENV OS_JAVA_HOME=/opensearch-2.6.0/jdk/    ENV OS_HOME=/opensearch-2.6.0    COPY opensearch.yml /opensearch-2.6.0/config/    RUN groupadd opensearch && useradd -g opensearch opensearch    RUN mkdir /var/lib/logs    RUN chown opensearch:opensearch /var/lib/logs    RUN mkdir /var/lib/data    RUN chown opensearch:opensearch /var/lib/data    RUN mkdir -p "/opt/opensearch-2.6.0/snapshots"    RUN chown -R opensearch:opensearch /opt/opensearch-2.6.0/snapshots    RUN chown -R opensearch:opensearch /opensearch-2.6.0/    USER opensearch    CMD "${OS_HOME}/bin/opensearch"    ```    </details>* ссылку на образ в репозитории dockerhub\[docker-образ](https://hub.docker.com/repository/docker/gsmik/openserver2_6_0-centos7/general)* ответ Elasticsearch на запрос пути / в json-виде.  ```shell  vagrant@server1:/usr/stck$ curl -X GET "http://localhost:9200"  {  "name" : "netology_test",  "cluster_name" : "netology_test",  "cluster_uuid" : "wKqSB7sYR8WvKAscaMzTCw",  "version" : {    "distribution" : "opensearch",    "number" : "2.6.0",    "build_type" : "tar",    "build_hash" : "7203a5af21a8a009aece1474446b437a3c674db6",    "build_date" : "2023-02-24T18:57:04.388618985Z",    "build_snapshot" : false,    "lucene_version" : "9.5.0",    "minimum_wire_compatibility_version" : "7.10.0",    "minimum_index_compatibility_version" : "7.0.0"  },  "tagline" : "The OpenSearch Project: https://opensearch.org/"  ```## Задача 2В этом задании вы научитесь:- создавать и удалять индексы,- изучать состояние кластера,- обосновывать причину деградации доступности данных.Ознакомьтесь с [документацией](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-create-index.html) и добавьте в `Elasticsearch` 3 индекса в соответствии с таблицей:| Имя | Количество реплик | Количество шард ||-----|-------------------|-----------------|| ind-1| 0 | 1 || ind-2 | 1 | 2 || ind-3 | 2 | 4 |Получите список индексов и их статусов, используя API, и **приведите в ответе** на задание.Получите состояние кластера `Elasticsearch`, используя API.Как вы думаете, почему часть индексов и кластер находятся в состоянии yellow?Удалите все индексы.**Важно**При проектировании кластера Elasticsearch нужно корректно рассчитывать количество реплик и шард,иначе возможна потеря данных индексов, вплоть до полной, при деградации системы.*Ответ** Ознакомьтесь с [документацией](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-create-index.html) и добавьте в `Elasticsearch` 3 индекса в соответствии с таблицей:  | Имя | Количество реплик | Количество шард |  |-----|-------------------|-----------------|  | ind-1| 0 | 1 |  | ind-2 | 1 | 2 |  | ind-3 | 2 | 4 |  ```shell  vagrant@server1:/usr/stck$ curl -X PUT "localhost:9200/ind-1?pretty" -H 'Content-Type: application/json' -d'  > {  >   "settings": {  >     "index": {  >       "number_of_shards": 1,    >       "number_of_replicas": 0   >     }  >   }  > }  > '  {    "acknowledged" : true,    "shards_acknowledged" : true,    "index" : "ind-1"  }  vagrant@server1:/usr/stck$ curl -X PUT "localhost:9200/ind-2?pretty" -H 'Content-Type: application/json' -d'  > {  >   "settings": {  >     "index": {  >       "number_of_shards": 2,    >       "number_of_replicas": 1  >     }  >   }  > }  > '  {    "acknowledged" : true,    "shards_acknowledged" : true,    "index" : "ind-2"  }  vagrant@server1:/usr/stck$ curl -X PUT "localhost:9200/ind-3?pretty" -H 'Content-Type: application/json' -d'  > {  >   "settings": {  >     "index": {  >       "number_of_shards": 4,    >       "number_of_replicas": 2  >     }  >   }  > }  > '  {    "acknowledged" : true,    "shards_acknowledged" : true,    "index" : "ind-3"  }  vagrant@server1:/usr/stck$             ```* Получите список индексов и их статусов, используя API, и **приведите в ответе** на задание.  ```shell  vagrant@server1:/usr/stck$ curl -X GET http://localhost:9200/_cat/indices?v=true  health status index                     uuid                   pri rep docs.count docs.deleted store.size pri.store.size  green  open   .opensearch-observability MI4wIh3QSt-Ii_vzdW9Lig   1   0          0            0       208b           208b  green  open   ind-1                     DMGPiydmQMSncdiQpsDuQQ   1   0          0            0       208b           208b  yellow open   ind-3                     x0twq46QQDCY6O4_L61IAA   4   2          0            0       832b           832b  yellow open   ind-2                     eVPdnHjkRkq9tZSGGkBHsQ   2   1          0            0       416b           416b  vagrant@server1:/usr/stck$   ```* Получите состояние кластера Elasticsearch, используя API.  ```shell  vagrant@server1:/usr/stck$ curl -X GET http://localhost:9200/_cluster/health?pretty=true  {  "cluster_name" : "netology_test",  "status" : "yellow",  "timed_out" : false,  "number_of_nodes" : 1,  "number_of_data_nodes" : 1,  "discovered_master" : true,  "discovered_cluster_manager" : true,  "active_primary_shards" : 8,  "active_shards" : 8,  "relocating_shards" : 0,  "initializing_shards" : 0,  "unassigned_shards" : 10,  "delayed_unassigned_shards" : 0,  "number_of_pending_tasks" : 0,  "number_of_in_flight_fetch" : 0,  "task_max_waiting_in_queue_millis" : 0,  "active_shards_percent_as_number" : 44.44444444444444  }  ```* Как вы думаете, почему часть индексов и кластер находятся в состоянии yellow?\  **Потому что ind-2 и ind-3 были созданы с репликами, а нода 1*** Удалите все индексы  ```shell  vagrant@server1:/usr/stck$ curl -X DELETE http://localhost:9200/ind-1?pretty && curl -X DELETE http://localhost:9200/ind-2?pretty && curl -X DELETE http://localhost:9200/ind-3?pretty  {    "acknowledged" : true  }  {    "acknowledged" : true  }  {    "acknowledged" : true  }  vagrant@server1:/usr/stck$   vagrant@server1:/usr/stck$ curl -X GET http://localhost:9200/_cat/indices?v=true  health status index                     uuid                   pri rep docs.count docs.deleted store.size pri.store.size  green  open   .opensearch-observability MI4wIh3QSt-Ii_vzdW9Lig   1   0          0            0       208b           208b  ```## Задача 3В этом задании вы научитесь:- создавать бэкапы данных,- восстанавливать индексы из бэкапов.Создайте директорию `{путь до корневой директории с Elasticsearch в образе}/snapshots`.Используя API, [зарегистрируйте](https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-register-repository.html#snapshots-register-repository) эту директорию как `snapshot repository` c именем `netology_backup`.**Приведите в ответе** запрос API и результат вызова API для создания репозитория.Создайте индекс `test` с 0 реплик и 1 шардом и **приведите в ответе** список индексов.[Создайте `snapshot`](https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-take-snapshot.html) состояния кластера `Elasticsearch`.**Приведите в ответе** список файлов в директории со `snapshot`.Удалите индекс `test` и создайте индекс `test-2`. **Приведите в ответе** список индексов.[Восстановите](https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-restore-snapshot.html) состояниекластера `Elasticsearch` из `snapshot`, созданного ранее. **Приведите в ответе** запрос к API восстановления и итоговый список индексов.Подсказки:- возможно, вам понадобится доработать `elasticsearch.yml` в части директивы `path.repo` и перезапустить `Elasticsearch`.---### Как cдавать заданиеВыполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.---